/*!
 * Bootstrap MultiSelect - jQuery Plugin v1.1.0
 * 
 * A powerful multi-select dropdown plugin built with Bootstrap 5
 * Supports declarative configuration via data attributes and programmatic control via JavaScript API
 * 
 * This plugin transforms standard HTML select elements or input fields into feature-rich
 * multi-select dropdowns with search, filtering, select all/deselect all functionality,
 * maximum selection limits, disabled options, optgroup support, and more.
 * 
 * Authors: Paolo Gaetano
 * Copyright (c) 2026 Paolo Gaetano
 * Released under the MIT license
 * 
 * @requires jQuery >= 3.6
 * @requires Bootstrap >= 5.0
 */
!function($){"use strict";$.fn.bootstrapMultiSelect=$.fn.bootstrapMultiSelect||{},$.fn.bootstrapMultiSelect.langs=$.fn.bootstrapMultiSelect.langs||{en:{placeholder:"Select items...",searchPlaceholder:"Search...",selectAllText:"Select All",deselectAllText:"Deselect All",noResultsText:"No results found",itemsSelectedText:"items selected"}},$.fn.bootstrapMultiSelect.lang=$.fn.bootstrapMultiSelect.lang||"en";const defaults={placeholder:"Select items...",maxSelection:0,selectAll:!0,search:!0,width:"100%",theme:"primary",data:[],valueField:"id",textField:"text",selectedValues:[],closeOnSelect:!1,enableClickableOptGroups:!1,buttonClass:"btn-outline-secondary",dropdownClass:"",searchPlaceholder:"Search...",selectAllText:"Select All",deselectAllText:"Deselect All",noResultsText:"No results found",maxHeight:"300px",itemsSelectedText:"items selected",lang:null};class BootstrapMultiSelect{constructor(element,options){this.$element=$(element),this.options=this._getOptions(options),this.id=this._generateId(),this.isOpen=!1,this.selectedItems=[],this._init()}_getOptions(options){const dataOptions={placeholder:this.$element.data("placeholder"),maxSelection:this.$element.data("max-selection"),selectAll:this.$element.data("select-all"),search:this.$element.data("search"),width:this.$element.data("width"),theme:this.$element.data("theme"),valueField:this.$element.data("value-field"),textField:this.$element.data("text-field"),closeOnSelect:this.$element.data("close-on-select"),buttonClass:this.$element.data("button-class"),dropdownClass:this.$element.data("dropdown-class"),searchPlaceholder:this.$element.data("search-placeholder"),selectAllText:this.$element.data("select-all-text"),deselectAllText:this.$element.data("deselect-all-text"),noResultsText:this.$element.data("no-results-text"),maxHeight:this.$element.data("max-height"),itemsSelectedText:this.$element.data("items-selected-text"),lang:this.$element.data("lang")};Object.keys(dataOptions).forEach((key=>{void 0===dataOptions[key]&&delete dataOptions[key]}));const mergedOptions=$.extend(!0,{},defaults,dataOptions,options);if($.fn.bootstrapMultiSelect&&$.fn.bootstrapMultiSelect.langs){let lang;lang=void 0!==dataOptions.lang?dataOptions.lang:options&&void 0!==options.lang?options.lang:$.fn.bootstrapMultiSelect.lang||"en";const langData=$.fn.bootstrapMultiSelect.langs[lang];langData&&(dataOptions.placeholder||options?.placeholder||(mergedOptions.placeholder=langData.placeholder),dataOptions.searchPlaceholder||options?.searchPlaceholder||(mergedOptions.searchPlaceholder=langData.searchPlaceholder),dataOptions.selectAllText||options?.selectAllText||(mergedOptions.selectAllText=langData.selectAllText),dataOptions.deselectAllText||options?.deselectAllText||(mergedOptions.deselectAllText=langData.deselectAllText),dataOptions.noResultsText||options?.noResultsText||(mergedOptions.noResultsText=langData.noResultsText),dataOptions.itemsSelectedText||options?.itemsSelectedText||(mergedOptions.itemsSelectedText=langData.itemsSelectedText))}return mergedOptions}_generateId(){return"bs-multiselect-"+Math.random().toString(36).substr(2,9)}_init(){this.$element.css({position:"absolute",left:"-9999px",width:"1px",height:"1px"}),this._loadData(),this._buildDropdown(),this._setInitialSelection(),this._bindEvents()}_loadData(){this.options.data&&Array.isArray(this.options.data)&&this.options.data.length>0||this.$element.is("select")&&(this.options.data=this._parseSelectOptions())}_parseSelectOptions(){const data=[],self=this;return this.$element.find("option, optgroup").each((function(){const $this=$(this);if($this.is("optgroup")){const group={label:$this.attr("label"),children:[]};$this.find("option").each((function(){const $option=$(this);group.children.push({[self.options.valueField]:$option.val(),[self.options.textField]:$option.text(),selected:$option.prop("selected"),disabled:$option.prop("disabled")})})),data.push(group)}else $this.parent().is("optgroup")||data.push({[self.options.valueField]:$this.val(),[self.options.textField]:$this.text(),selected:$this.prop("selected"),disabled:$this.prop("disabled")})})),data}_buildDropdown(){const buttonClass=this.options.buttonClass||`btn-outline-${this.options.theme}`;this.$container=$(`\n                <div class="bs-multiselect-container dropdown" style="width: ${this.options.width}">\n                    <button class="btn ${buttonClass} dropdown-toggle w-100 text-start d-flex justify-content-between align-items-center" \n                            type="button" \n                            id="${this.id}-button" \n                            data-bs-toggle="dropdown" \n                            aria-expanded="false">\n                        <span class="bs-multiselect-placeholder">${this.options.placeholder}</span>\n                        <span class="bs-multiselect-badge badge bg-${this.options.theme} ms-2" style="display: none;">0</span>\n                    </button>\n                    <div class="dropdown-menu w-100 ${this.options.dropdownClass}" \n                         aria-labelledby="${this.id}-button" \n                         style="max-height: ${this.options.maxHeight}; overflow-y: auto;">\n                        ${this._buildDropdownContent()}\n                    </div>\n                </div>\n            `),this.$element.after(this.$container),this.$button=this.$container.find(".dropdown-toggle"),this.$dropdownMenu=this.$container.find(".dropdown-menu"),this.$placeholder=this.$container.find(".bs-multiselect-placeholder"),this.$badge=this.$container.find(".bs-multiselect-badge"),this.$searchInput=this.$container.find(".bs-multiselect-search"),this.$selectAllBtn=this.$container.find(".bs-multiselect-select-all"),this.$deselectAllBtn=this.$container.find(".bs-multiselect-deselect-all"),this.$optionsList=this.$container.find(".bs-multiselect-options"),this.$noResults=this.$container.find(".bs-multiselect-no-results")}_buildDropdownContent(){let html='<div class="p-2">';return this.options.search&&(html+=`\n                    <div class="mb-2">\n                        <input type="text" \n                               class="form-control form-control-sm bs-multiselect-search" \n                               placeholder="${this.options.searchPlaceholder}">\n                    </div>\n                `),this.options.selectAll&&(html+=`\n                    <div class="mb-2 d-flex gap-2">\n                        <button type="button" class="btn btn-sm btn-outline-primary bs-multiselect-select-all flex-fill">\n                            ${this.options.selectAllText}\n                        </button>\n                        <button type="button" class="btn btn-sm btn-outline-secondary bs-multiselect-deselect-all flex-fill">\n                            ${this.options.deselectAllText}\n                        </button>\n                    </div>\n                `),html+='<hr class="my-2">',html+='<div class="bs-multiselect-options">',html+=this._buildOptions(),html+="</div>",html+=`\n                <div class="bs-multiselect-no-results text-muted text-center py-2" style="display: none;">\n                    <small>${this.options.noResultsText}</small>\n                </div>\n            `,html+="</div>",html}_buildOptions(){let html="";return this.options.data.forEach(((item,index)=>{item.label&&item.children?html+=this._buildOptGroup(item,index):html+=this._buildOption(item,index)})),html}_buildOptGroup(group,index){let html=`\n                <div class="bs-multiselect-optgroup" data-group-index="${index}">\n                    <div class="fw-bold text-muted small px-2 py-1">${group.label}</div>\n                    <div class="ps-3">\n            `;return group.children.forEach(((child,childIndex)=>{html+=this._buildOption(child,`${index}-${childIndex}`,!0)})),html+="</div></div>",html}_buildOption(option,index,isChild=!1){const value=option[this.options.valueField],text=option[this.options.textField],disabled=option.disabled?"disabled":"",disabledData=option.disabled?'data-original-disabled="true"':"";return`\n                <div class="form-check bs-multiselect-option" data-value="${value}" data-index="${index}">\n                    <input class="form-check-input" \n                           type="checkbox" \n                           value="${value}" \n                           id="${this.id}-option-${index}" \n                           ${disabled}\n                           ${disabledData}>\n                    <label class="form-check-label w-100" for="${this.id}-option-${index}">\n                        ${text}\n                    </label>\n                </div>\n            `}_bindEvents(){const self=this;this.$dropdownMenu.on("click",(function(e){self.options.closeOnSelect||e.stopPropagation()})),this.$dropdownMenu.on("change",".form-check-input",(function(e){e.stopPropagation(),self._onOptionChange($(this))})),this.$selectAllBtn.on("click",(function(e){e.preventDefault(),e.stopPropagation(),self._selectAll()})),this.$deselectAllBtn.on("click",(function(e){e.preventDefault(),e.stopPropagation(),self._deselectAll()})),this.options.search&&this.$searchInput.on("input",(function(){self._filterOptions($(this).val())})),this.$container.on("shown.bs.dropdown",(function(){self.isOpen=!0,self.options.search&&self.$searchInput.focus()})),this.$container.on("hidden.bs.dropdown",(function(){self.isOpen=!1,self.options.search&&(self.$searchInput.val(""),self._filterOptions(""))}));const $form=this.$element.closest("form");$form.length>0&&($form.on("reset.bs-multiselect",(function(e){setTimeout((function(){self.reset()}),0)})),$form.on("submit.bs-multiselect",(function(e){$.validator&&$form.data("validator")&&setTimeout((function(){const validator=$form.data("validator"),elementName=self.$element.attr("name");if(validator.settings.rules&&validator.settings.rules[elementName]){const hasError=validator.invalid&&validator.invalid[elementName];self._updateValidationState(!hasError)}}),0)}))),$.validator&&(this.$element.on("invalid-form.validate",(function(){self._updateValidationState(!1)})),this.$element.on("change",(function(){setTimeout((function(){const $form=self.$element.closest("form");if($form.length&&$form.data("validator")){const validator=$form.data("validator"),elementName=self.$element.attr("name");if(validator.settings.rules&&validator.settings.rules[elementName]){const hasError=validator.invalid&&validator.invalid[elementName];self._updateValidationState(!hasError)}}}),100)})))}_onOptionChange($checkbox){const value=$checkbox.val();if($checkbox.prop("checked")){if(this.options.maxSelection>0&&this.selectedItems.length>=this.options.maxSelection)return $checkbox.prop("checked",!1),void this._showMaxSelectionWarning();this.selectedItems.push(value)}else{const index=this.selectedItems.indexOf(value);index>-1&&this.selectedItems.splice(index,1)}this._updateDisplay(),this._updateValue(),this._triggerChange(),this._updateMaxSelectionState()}_selectAll(){const self=this,$visibleCheckboxes=this.$optionsList.find(".bs-multiselect-option:visible .form-check-input").filter((function(){return!$(this).data("original-disabled")}));if(this.options.maxSelection>0){const availableSlots=this.options.maxSelection-this.selectedItems.length;if(availableSlots<=0)return void this._showMaxSelectionWarning();let slotsUsed=0;$visibleCheckboxes.each((function(){const $checkbox=$(this);!$checkbox.prop("checked")&&slotsUsed<availableSlots&&($checkbox.prop("checked",!0),self.selectedItems.push($checkbox.val()),slotsUsed++)})),slotsUsed<$visibleCheckboxes.filter(":not(:checked)").length&&this._showMaxSelectionWarning()}else $visibleCheckboxes.each((function(){const $checkbox=$(this);$checkbox.prop("checked")||($checkbox.prop("checked",!0),self.selectedItems.push($checkbox.val()))}));this.selectedItems=[...new Set(this.selectedItems)],this._updateDisplay(),this._updateValue(),this._triggerChange(),this._updateMaxSelectionState()}_deselectAll(){this.$optionsList.find(".form-check-input:checked").prop("checked",!1),this.selectedItems=[],this._updateDisplay(),this._updateValue(),this._triggerChange(),this._updateMaxSelectionState()}_filterOptions(query){const searchTerm=query.toLowerCase().trim();if(!searchTerm)return this.$optionsList.find(".bs-multiselect-option, .bs-multiselect-optgroup").show(),void this.$noResults.hide();let visibleCount=0;this.$optionsList.find(".bs-multiselect-option").each((function(){const $option=$(this);$option.find(".form-check-label").text().toLowerCase().includes(searchTerm)?($option.show(),visibleCount++):$option.hide()})),this.$optionsList.find(".bs-multiselect-optgroup").each((function(){const $group=$(this);$group.find(".bs-multiselect-option:visible").length>0?$group.show():$group.hide()})),0===visibleCount?this.$noResults.show():this.$noResults.hide()}_updateDisplay(){const count=this.selectedItems.length;if(0===count)this.$placeholder.text(this.options.placeholder),this.$badge.hide(),this.$badge.text("0");else{const selectedTexts=[];this.selectedItems.forEach((value=>{const text=this.$optionsList.find(`.form-check-input[value="${value}"]`).next(".form-check-label").text();selectedTexts.push(text)})),count<=3?this.$placeholder.text(selectedTexts.join(", ")):this.$placeholder.text(`${count} ${this.options.itemsSelectedText}`),this.$badge.text(count).show()}}_updateValue(){this.$element.is("select")?(this.$element.find("option").prop("selected",!1),this.selectedItems.length>0&&this.selectedItems.forEach((value=>{this.$element.find(`option[value="${value}"]`).prop("selected",!0)})),this.$element.val(this.selectedItems.length>0?this.selectedItems:null)):this.$element.val(this.selectedItems.length>0?JSON.stringify(this.selectedItems):""),this.$element.trigger("change")}_triggerChange(){this.$element.trigger("change.bs-multiselect",[{selectedValues:this.selectedItems}]);const $form=this.$element.closest("form");if($.validator&&$form.length>0&&$form.data("validator")){const self=this,elementName=self.$element.attr("name"),validator=$form.data("validator");if(validator.settings.rules&&validator.settings.rules[elementName]){self.$element.valid();setTimeout((function(){const hasError=validator.invalid&&validator.invalid[elementName];self._updateValidationState(!hasError)}),50)}}}_updateValidationState(isValid){isValid?(this.$button.removeClass("is-invalid border-danger"),this.$button.addClass("is-valid")):(this.$button.removeClass("is-valid"),this.$button.addClass("is-invalid border-danger"))}_setInitialSelection(){const self=this;if(this.$element.is("select"))this.$element.find("option[selected]").each((function(){const value=$(this).val();value&&!self.selectedItems.includes(value)&&self.selectedItems.push(value)}));else if(this.options.selectedValues&&Array.isArray(this.options.selectedValues)&&this.options.selectedValues.length>0)this.selectedItems=[...this.options.selectedValues];else if(this.options.data&&Array.isArray(this.options.data))this.options.data.forEach((item=>{if(item.children)item.children.forEach((child=>{if(child.selected){const value=child[this.options.valueField];value&&!self.selectedItems.includes(value)&&self.selectedItems.push(value)}}));else if(item.selected){const value=item[this.options.valueField];value&&!this.selectedItems.includes(value)&&self.selectedItems.push(value)}}));else if(this.$element.val())try{const values=JSON.parse(this.$element.val());Array.isArray(values)&&(this.selectedItems=values)}catch(e){}this.initialSelectedItems=[...this.selectedItems],this.selectedItems.forEach((value=>{this.$optionsList.find(`.form-check-input[value="${value}"]`).prop("checked",!0)})),this._updateDisplay(),this._updateValue(),this._updateMaxSelectionState()}_updateMaxSelectionState(){if(this.options.maxSelection>0){const limitReached=this.selectedItems.length>=this.options.maxSelection;this.$optionsList.find(".form-check-input").each((function(){const $checkbox=$(this),isChecked=$checkbox.prop("checked");!0===$checkbox.data("original-disabled")||(limitReached&&!isChecked?($checkbox.prop("disabled",!0),$checkbox.closest(".bs-multiselect-option").addClass("disabled")):($checkbox.prop("disabled",!1),$checkbox.closest(".bs-multiselect-option").removeClass("disabled")))}));const $selectAllBtn=this.$dropdownMenu.find(".bs-multiselect-select-all");limitReached?$selectAllBtn.prop("disabled",!0).addClass("disabled"):$selectAllBtn.prop("disabled",!1).removeClass("disabled")}}_showMaxSelectionWarning(){console.warn(`Maximum selection limit reached (${this.options.maxSelection})`)}getSelectedValues(){return[...this.selectedItems]}setSelectedValues(values){if(!Array.isArray(values))return;this._deselectAll();const self=this;values.forEach((value=>{const $checkbox=this.$optionsList.find(`.form-check-input[value="${value}"]`);$checkbox.length&&!$checkbox.prop("disabled")&&($checkbox.prop("checked",!0),self.selectedItems.push(value))})),this._updateDisplay(),this._updateValue(),this._triggerChange()}refresh(){const currentSelection=[...this.selectedItems];this.$container.remove(),this._init(),this.setSelectedValues(currentSelection)}destroy(){const $form=this.$element.closest("form");$form.length>0&&($form.off("reset.bs-multiselect"),$form.off("submit.bs-multiselect")),$.validator&&this.$element.off("invalid-form.validate"),this.$container.remove(),this.$element.css({position:"",left:"",width:"",height:""}).show(),this.$element.removeData("bootstrapMultiSelect"),this.$element.removeData("bs-multiselect")}enable(){this.$button.prop("disabled",!1)}disable(){this.$button.prop("disabled",!0)}reset(){this.$optionsList.find(".form-check-input:checked").prop("checked",!1),this.selectedItems=this.initialSelectedItems?[...this.initialSelectedItems]:[],this.selectedItems.forEach((value=>{this.$optionsList.find(`.form-check-input[value="${value}"]`).prop("checked",!0)})),this.$element.is("select")&&(this.$element.find("option").prop("selected",!1),this.selectedItems.forEach((value=>{this.$element.find(`option[value="${value}"]`).prop("selected",!0)}))),this._updateDisplay(),this._updateValue(),this._updateMaxSelectionState(),this._triggerChange()}}$.fn.bootstrapMultiSelect=function(options){const args=Array.prototype.slice.call(arguments,1);let result;return this.each((function(){const $element=$(this);let instance=$element.data("bootstrapMultiSelect");if(instance?"object"==typeof options&&options.data&&Array.isArray(options.data)&&(instance.options.data=options.data,instance.refresh()):(instance=new BootstrapMultiSelect(this,"object"==typeof options?options:{}),$element.data("bootstrapMultiSelect",instance),$element.data("bs-multiselect",instance)),"string"==typeof options&&"function"==typeof instance[options]){const methodResult=instance[options].apply(instance,args);void 0!==methodResult&&(result=methodResult)}})),void 0!==result?result:this},$(document).ready((function(){$('[data-toggle="bootstrap-multiselect"]').bootstrapMultiSelect()}))}(jQuery);